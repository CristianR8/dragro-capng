<!-- src/app/home/home.component.html -->
<header class="bg-white shadow-sm">
  <nav class="navbar">
    <img
      src="images/menu.png"
      class="mx-auto"
      style="max-height:40px; padding:10px;"
      alt="Dr. Agro"
    />
  </nav>
</header>

<main class="py-4">
  <div class="container">
    <!-- Logo -->
    <div class="text-center mb-4">
      <img
        src="images/Logotipo-DR-AGRO-Color.png"
        alt="Agrosavia"
        class="img-fluid"
        style="max-height:200px;"
      />
    </div>

    <!-- Título -->
    <div class="text-center mb-4">
      <h4 class="fw-bold mb-1">PERFIL DE USUARIO</h4>
      <small class="text-secondary">Por favor selecciona la opción que mejor se ajuste a tu perfil</small>
    </div>

    <form>
      <!-- Opciones de Perfil -->
      <div class="row g-3 mb-4">
        <div *ngFor="let opt of profileOptions" class="col-6 col-sm-6 col-md-4">
          <div
            class="card h-100 text-center p-3 profile-card"
            [class.border-primary]="perfilSeleccionado === opt.id"
            (click)="selectProfile(opt.id)"
            style="cursor:pointer;">
            <input
              type="radio"
              name="perfil"
              [id]="opt.id"
              [(ngModel)]="perfilSeleccionado"
              [value]="opt.id"
              hidden
            />
            <i [class]="opt.icon + ' mb-2 fs-1 text-primary'"></i>
            <h6 class="card-title">{{ opt.label }}</h6>
            <small class="text-muted">{{ opt.description }}</small>
          </div>
        </div>
      </div>

      <!-- Departamento -->
      <div class="mb-3 position-relative">
        <label for="departamento" class="form-label">Departamento <span class="text-danger">*</span></label>
        <input
          id="departamento"
          name="departamento"
          type="text"
          class="form-control"
          [(ngModel)]="departamentoText"
          (input)="filterDepartamentos($event)"
          (focus)="showDepartamentos = true"
          (blur)="hideDepartamentosDropdown()"
          placeholder="Escriba o seleccione un departamento"
          autocomplete="off"
          [class.is-invalid]="departamentoInvalid"
          [class.is-valid]="departamentoValid"
        />
        <ul
          class="dropdown-menu w-100"
          [class.show]="showDepartamentos && filteredDepartamentos.length > 0"
        >
          <li *ngFor="let dept of filteredDepartamentos">
            <button
              type="button"
              class="dropdown-item"
              (mousedown)="selectDepartamento(dept)"
            >
              {{ dept.name }}
            </button>
          </li>
        </ul>
        <div class="invalid-feedback" *ngIf="departamentoInvalid">
          Por favor seleccione un departamento válido de Colombia.
        </div>
      </div>

      <!-- Municipio -->
      <div class="mb-3 position-relative">
        <label for="municipio" class="form-label">Municipio <span class="text-danger">*</span></label>
        <input
          id="municipio"
          name="municipio"
          type="text"
          class="form-control"
          [(ngModel)]="municipioText"
          (input)="filterMunicipios($event)"
          (focus)="showMunicipios = true"
          (blur)="hideMunicipiosDropdown()"
          placeholder="Escriba o seleccione un municipio"
          autocomplete="off"
          [disabled]="!selectedDepartamento"
          [class.is-invalid]="municipioInvalid"
          [class.is-valid]="municipioValid"
        />
        <ul
          class="dropdown-menu w-100"
          [class.show]="showMunicipios && filteredMunicipios.length > 0"
        >
          <li *ngFor="let mun of filteredMunicipios">
            <button
              type="button"
              class="dropdown-item"
              (mousedown)="selectMunicipio(mun)"
            >
              {{ mun.name }}
            </button>
          </li>
        </ul>
        <div class="invalid-feedback" *ngIf="municipioInvalid">
          Por favor seleccione un municipio válido del departamento seleccionado.
        </div>
        <div class="form-text" *ngIf="!selectedDepartamento">
          Primero debe seleccionar un departamento
        </div>
      </div>

      <!-- Correo electrónico -->
      <div class="mb-3">
        <label for="correo" class="form-label">Correo electrónico <span class="text-danger">*</span></label>
        <input
          id="correo"
          name="correo"
          type="email"
          class="form-control"
          [(ngModel)]="usuario.correo"
          (input)="validateEmail()"
          (blur)="validateEmail()"
          placeholder="ejemplo@correo.com"
          [class.is-invalid]="emailInvalid"
          [class.is-valid]="emailValid"
          maxlength="100"
        />
        <div class="invalid-feedback" *ngIf="emailInvalid">
          {{ emailErrorMessage }}
        </div>
        <div class="form-text" *ngIf="!emailInvalid && !emailValid">
          Ingrese un correo electrónico válido
        </div>
      </div>

      <!-- Botón Guardar -->
      <button
        type="button"
        class="btn btn-success w-100 mb-4"
        [disabled]="!isFormValid()"
        (click)="guardarInformacion()"
      >
        Guardar información
      </button>
    </form>

    <!-- Footer -->
    <div class="text-center mt-4">
      <img
        src="images/agrosavia_color.png"
        alt="Agrosavia"
        class="img-fluid"
        style="max-height:30px;"
      />
    </div>
  </div>
</main>
